<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Corrections ‚Äî Logigrammes (remplacement)</title>
  <style>
  /* Base */
  body{
    margin:0;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial;
    background:#f9fafb;
    color:#1a1a1a;
    display:flex; min-height:100dvh; align-items:center; justify-content:center;
  }

  /* L'app devient une colonne flexible */
  .app{
    width:min(1100px,92vw);
    display:flex;
    flex-direction:column;
    /* √©vite que la signature masque le bas */
  }

  /* Barre d‚Äôoutils */
  .toolbar{
    display:flex; flex-wrap:wrap; gap:.5rem; align-items:center;
    background:#fff; border:1px solid #ccc; border-radius:12px; padding:.6rem .8rem;
    box-shadow:0 4px 12px rgba(0,0,0,.08);
  }
  .title{ font-weight:800; margin-right:auto; letter-spacing:.3px; }
  select, .btn{
    appearance:none; border:1px solid #ccc; background:#f1f5f9; color:#222;
    padding:.4rem .8rem; border-radius:8px; cursor:pointer; font-weight:600; transition:all .15s ease;
  }
  .btn:hover, select:hover{ background:#e5e9ef; }
  .range{ accent-color:#3b82f6; }

  /* Viewer + layout prennent toute la hauteur dispo */
  .viewer{
    position:relative; margin-top:12px; background:#fff; border:1px solid #ccc; border-radius:12px;
    padding:12px; box-shadow:0 8px 20px rgba(0,0,0,.08);
    flex:1;                 /* NEW */
    display:flex;           /* NEW */
    flex-direction:column;  /* NEW */
    /* Gestes tactiles : on g√®re nous-m√™mes le scroll/gestes dans le viewer */
.viewer { touch-action: none; }

  }
  .layout{
    flex:1; /* NEW */
    display:grid;
    grid-template-columns:1.3fr .9fr;
    gap:12px;
  }
  @media (max-width:900px){ .layout{ grid-template-columns:1fr; } }

  /* Colonne gauche = colonne flexible : la sc√®ne peut grandir */
  .layout > div:first-child{
    display:flex;           /* NEW */
    flex-direction:column;  /* NEW */
    min-height:0;           /* NEW: √©vite les d√©bordements */
  }

  /* Sc√®ne */
  .stage{
    position:relative; width:100%;
    aspect-ratio:16/9; background:#f3f4f6; border-radius:8px; overflow:hidden;
    display:grid; place-items:center;
    flex:1; /* NEW : occupe la hauteur */
  }
  .layer{
    position:absolute; inset:0; object-fit:contain; width:100%; height:100%;
    opacity:0; transition:opacity 320ms ease; pointer-events:none;
  }
  .layer.visible{ opacity:1; }

  /* L√©gende + pastilles */
  .legend{ display:flex; justify-content:space-between; align-items:center; gap:.8rem; margin-top:.6rem; font-size:.92rem; color:#444; }
  .dots{ display:flex; gap:.35rem; align-items:center; flex-wrap:wrap; }
  .dot{ width:.7rem; height:.7rem; border-radius:999px; background:#d1d5db; border:1px solid #9ca3af; }
  .dot.active{ background:#3b82f6; border-color:#2563eb; }

  /* Bloc explications */
  .explanation{
    background:#f0f9ff; border-left:4px solid #3b82f6; border-radius:6px; padding:12px; line-height:1.5;
  }
  .muted{ color:#555; }

  /* Signature en bas √† droite DU GRAND BLOC BLANC (.viewer) */
  .signature{
    text-align:right;
    font-size:.8rem;
    color:#1e3a8a;
    font-weight:600;
    margin-top:12px;
    padding-top:6px;
    border-top:1px solid #e5e7eb;
  }

  /* === PLEIN √âCRAN === */
  /* Quand .app passe en fullscreen, elle occupe TOUT l'√©cran */
  .app:fullscreen,
  .app:-webkit-full-screen{
    width:100vw;
    height:100dvh;
    max-width:none;
  }
  /* Forcer les descendants √† prendre la hauteur */
  .app:fullscreen .viewer,
  .app:-webkit-full-screen .viewer{
    flex:1;
  }
  .app:fullscreen .layout,
  .app:-webkit-full-screen .layout{
    height:100%;
  }
</style>

</head>

<body>
  <div class="app">
    <div class="toolbar">
      <div class="title">Corrections ‚Äî Logigrammes ‚Äî S√©rie n¬∞1</div>
      <label for="exercise" class="muted">Exercice</label>
      <select id="exercise"></select>
      <button id="play"  class="btn" aria-pressed="false" title="Lecture/Pause (Espace)">Lecture</button>
      <button id="prev"  class="btn" title="Pr√©c√©dent (‚Üê)">‚üµ</button>
      <button id="next"  class="btn" title="Suivant (‚Üí)">‚ü∂</button>
      <button id="reset" class="btn" title="R√©initialiser (R)">R√©init</button>
      <button id="fullscreen" class="btn" title="Plein √©cran (F)" aria-pressed="false">‚õ∂ Plein √©cran</button>

      <label for="speed" class="muted">Vitesse</label>
      <input id="speed" class="range" type="range" min="400" max="4000" step="100" value="1200" />
    </div>

    <div class="viewer">
  <div class="layout">
    <!-- Colonne gauche : images -->
    <div>
      <div class="stage" id="stage"></div>
      <div class="legend">
        <div id="status"></div>
        <div class="dots" id="dots"></div>
      </div>
    </div>

    <!-- Colonne droite : explications -->
    <div>
      <div class="explanation">
        <div id="exTitle" style="font-weight:700;margin-bottom:.3rem;"></div>
        <div id="stepTitle" style="font-weight:600;margin-bottom:.2rem;"></div>
        <div id="expl"></div>
        <div class="muted" style="margin-top:.6rem;font-size:.9rem;">
          Astuce : <b>Espace</b> lecture/pause ‚Ä¢ <b>‚Üê</b>/<b>‚Üí</b> √©tape pr√©c√©dente/suivante ‚Ä¢ <b>R</b> r√©init.
        </div>
      </div>
    </div>
  </div>

  <!-- üëâ Signature en bas √† droite du grand bloc blanc -->
  <div class="signature">
    Technologie ‚Äì Les algorithmes -  Vincent Belhaire<br>
  </div>
</div>

      </div>
    </div>
  </div>

  <script>
  const MANIFEST = [
    {
      "title": "1 - Alarme de moto",
      "steps": [
        { "src": "1-Alarme de moto/Alarme de moto 1.svg", "label": "Sc√©nario 1",
          "explanation": "üëâ L‚Äôalarme n‚Äôest pas activ√©e, elle attend en boucle d‚Äô√™tre enclench√©e." },
        { "src": "1-Alarme de moto/Alarme de moto 2.svg", "label": "Sc√©nario 2",
          "explanation": "üëâ L‚Äôalarme est activ√©e, elle v√©rifie en continu si la moto est d√©plac√©e. Ici, ce n‚Äôest pas le cas." },
        { "src": "1-Alarme de moto/Alarme de moto 3.svg", "label": "Sc√©nario 3",
          "explanation": "üëâ L‚Äôalarme est activ√©e, elle d√©tecte que la moto est d√©plac√©e : l‚Äôalarme se d√©clenche." }
      ]
    },
    {
      "title": "2 - Portique de m√©tro",
      "steps": [
        { "src": "2-Portique de m√©tro/0 - Poussoir - Led on_off(11).svg", "label": "Sc√©nario 1",
          "explanation": "üëâ Il n‚Äôy a pas de ticket introduit dans la borne de m√©tro. La borne attend en boucle qu‚Äôun ticket soit ins√©r√©." },
        { "src": "2-Portique de m√©tro/0 - Poussoir - Led on_off(12).svg", "label": "Sc√©nario 2",
          "explanation": "üëâ La borne d√©tecte un ticket et le v√©rifie. Comme il n‚Äôest pas valide, il est rejet√©. La borne attend alors un nouveau ticket." },
        { "src": "2-Portique de m√©tro/0 - Poussoir - Led on_off(13).svg", "label": "Sc√©nario 3",
          "explanation": "üëâ La borne d√©tecte un ticket et le v√©rifie. Comme il est valide, il est accept√©. Le portique s‚Äôouvre et la borne attend le passage de l‚Äôusager." },
        { "src": "2-Portique de m√©tro/0 - Poussoir - Led on_off(14).svg", "label": "Sc√©nario 4",
          "explanation": "üëâ La borne d√©tecte un ticket et le v√©rifie. Comme il est valide, il est accept√©. Elle ouvre le portique, d√©tecte le passage de l‚Äôusager puis referme le portique. La borne revient ensuite √† son √©tat initial et attend un nouveau ticket." }
      ]
    },
    {
      "title": "3 - Radar de vitesse",
      "steps": [
        { "src": "3-Radar de vitesse/Radar de vitesse 1.svg", "label": "Sc√©nario 1",
          "explanation": "üëâ La vitesse mesur√©e est ‚â§ 80 km/h. Le radar poursuit ses contr√¥les en boucle." },
        { "src": "3-Radar de vitesse/Radar de vitesse 2.svg", "label": "Sc√©nario 2",
          "explanation": "üëâ La vitesse mesur√©e est > 80 km/h : le radar d√©clenche le flash, lit la plaque, prend la photo, envoie la photo, puis reprend la surveillance." }
      ]
    },
    {
      "title": "4 - Distribution de boisson 1‚Ç¨",
      "steps": [
        { "src": "4-Distribution de boisson 1‚Ç¨/Distributeur 1.svg", "label": "Sc√©nario 1",
          "explanation": "üëâ Le distributeur attend qu‚Äôun client s√©lectionne une boisson, en boucle." },
        { "src": "4-Distribution de boisson 1‚Ç¨/Distributeur 2.svg", "label": "Sc√©nario 2",
          "explanation": "üëâ Un client s√©lectionne une boisson. Le distributeur affiche son prix et v√©rifie la pi√®ce ins√©r√©e : c‚Äôest bien une pi√®ce d‚Äôun euro. La boisson est distribu√©e, puis la machine revient √† son √©tat initial." },
        { "src": "4-Distribution de boisson 1‚Ç¨/Distributeur 3.svg", "label": "Sc√©nario 3",
          "explanation": "üëâ Un client s√©lectionne une boisson. Le distributeur affiche son prix et v√©rifie la pi√®ce ins√©r√©e : ce n‚Äôest pas une pi√®ce d‚Äôun euro. La pi√®ce est rejet√©e, puis la machine revient √† son √©tat initial." }
      ]
    },
    {
      "title": "5 - Distribution de boisson 2‚Ç¨",
      "steps": [
        { "src": "5-Distribution de boisson 2‚Ç¨/Distributeur 21.svg", "label": "Sc√©nario 1",
          "explanation": "üëâ Le distributeur attend qu‚Äôun client s√©lectionne une boisson, en boucle." },
        { "src": "5-Distribution de boisson 2‚Ç¨/Distributeur 22.svg", "label": "Sc√©nario 2 (pi√®ce invalide)",
          "explanation": "üëâ Un client s√©lectionne une boisson. Le distributeur affiche son prix et v√©rifie la pi√®ce ins√©r√©e : ni 1 ‚Ç¨ ni 2 ‚Ç¨. La pi√®ce est rejet√©e, puis la machine revient √† son √©tat initial." },
        { "src": "5-Distribution de boisson 2‚Ç¨/Distributeur 23.svg", "label": "Sc√©nario 3 (pi√®ce de 2 ‚Ç¨)",
          "explanation": "üëâ Un client s√©lectionne une boisson. Le distributeur affiche son prix et v√©rifie la pi√®ce ins√©r√©e : c‚Äôest une pi√®ce de 2 ‚Ç¨. La machine rend 1‚Ç¨ ; la boisson est distribu√©e, puis la machine revient √† son √©tat initial." },
        { "src": "5-Distribution de boisson 2‚Ç¨/Distributeur 24.svg", "label": "Sc√©nario 4 (pi√®ce de 1 ‚Ç¨ ‚Äì cr√©dit partiel)",
          "explanation": "üëâ Un client s√©lectionne une boisson. Le distributeur affiche son prix et v√©rifie la pi√®ce ins√©r√©e : c‚Äôest bien une pi√®ce d‚Äôun euro. La boisson est distribu√©e, puis la machine revient √† son √©tat initial." }
      ]
    }
  ];

  const stage = document.getElementById('stage');
  const dotsEl = document.getElementById('dots');
  const statusEl = document.getElementById('status');
  const playBtn = document.getElementById('play');
  const prevBtn = document.getElementById('prev');
  const nextBtn = document.getElementById('next');
  const resetBtn = document.getElementById('reset');
  const speedInput = document.getElementById('speed');
  const selectEl = document.getElementById('exercise');
  const fsBtn = document.getElementById('fullscreen');
const fsTarget = document.querySelector('.app'); // on met en plein √©cran TOUTE l'app pour garder la signature visible



  const exTitleEl = document.getElementById('exTitle');
  const stepTitleEl = document.getElementById('stepTitle');
  const explEl = document.getElementById('expl');

  let currentExercise = 0;
  let idx = 0;
  let playing = false;
  let timer = null;
  let stepDuration = parseInt(speedInput.value, 10);
  let layers = [];

  function initSelect(){
    selectEl.innerHTML = '';
    MANIFEST.forEach((ex, i) => {
      const opt = document.createElement('option');
      opt.value = i;
      opt.textContent = ex.title;
      selectEl.appendChild(opt);
    });
    selectEl.addEventListener('change', () => {
      stop();
      currentExercise = parseInt(selectEl.value, 10);
      loadExercise();
    });
  }

  function buildStage(ex){
    stage.innerHTML = '';
    layers = ex.steps.map(step => {
      const img = document.createElement('img');
      img.className = 'layer';
      img.alt = step.label;
      img.src = step.src;
      img.addEventListener('error', () => {
        statusEl.textContent = '‚ö†Ô∏è Fichier introuvable : ' + (img.getAttribute('src') || '');
        img.style.outline = '2px dashed #e11d48';
      }, { once: true });
      stage.appendChild(img);
      return img;
    });
  }

  function buildDots(len){
    dotsEl.innerHTML = '';
    for(let i=0;i<len;i++){ const d=document.createElement('div'); d.className='dot'; dotsEl.appendChild(d); }
  }
  function updateDots(iActive){
    Array.from(dotsEl.children).forEach((d,i)=>d.classList.toggle('active', i===iActive));
  }
  function applyVisibility(){
    layers.forEach((el,i)=> el.classList.toggle('visible', i===idx));
  }
  function setIndex(newIdx){
    idx = Math.max(0, Math.min(layers.length-1, newIdx));
    applyVisibility();
    const ex = MANIFEST[currentExercise];
    const step = ex.steps[idx];
    statusEl.textContent = `√âtape ${idx+1} / ${layers.length}`;
    exTitleEl.textContent = ex.title;
    stepTitleEl.textContent = step.label;
    explEl.textContent = step.explanation;
    updateDots(idx);
  }

  function next(){ if(idx < layers.length-1){ setIndex(idx+1); } else { setIndex(0); } }
  function prev(){ if(idx > 0){ setIndex(idx-1); } }
  function resetAll(){ stop(); setIndex(0); }

  function tick(){
    if(!playing) return;
    next();
    timer = setTimeout(tick, stepDuration);
  }
  function play(){
    if(playing) return;
    playing = true;
    playBtn.setAttribute('aria-pressed','true');
    playBtn.textContent = 'Pause';
    timer = setTimeout(tick, stepDuration);
  }
  function stop(){
    playing = false;
    playBtn.setAttribute('aria-pressed','false');
    playBtn.textContent = 'Lecture';
    if(timer){ clearTimeout(timer); timer=null; }
  }
  function togglePlay(){ playing ? stop() : play(); }

  speedInput.addEventListener('input', e => {
    stepDuration = parseInt(e.target.value, 10);
    if(playing){ stop(); play(); }
  });
  playBtn.addEventListener('click', togglePlay);
  prevBtn.addEventListener('click', ()=>{ stop(); prev(); });
  nextBtn.addEventListener('click', ()=>{ stop(); next(); });
  resetBtn.addEventListener('click', resetAll);

  window.addEventListener('keydown', (e) => {
    if(['INPUT','TEXTAREA','SELECT'].includes(document.activeElement?.tagName)) return;
    if(e.code === 'Space'){ e.preventDefault(); togglePlay(); }
    if(e.key === 'ArrowRight'){ e.preventDefault(); stop(); next(); }
    if(e.key === 'ArrowLeft'){ e.preventDefault(); stop(); prev(); }
    if(e.key.toLowerCase() === 'r'){ e.preventDefault(); resetAll(); }
  });

  function loadExercise(){
    const ex = MANIFEST[currentExercise];
    buildStage(ex);
    buildDots(ex.steps.length);
    setIndex(0);
  }

  initSelect();
  loadExercise();
  function isFullscreen() {
  return document.fullscreenElement != null;
}

async function enterFullscreen() {
  const el = fsTarget;
  if (el.requestFullscreen) await el.requestFullscreen();
  else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen(); // Safari
}

async function exitFullscreen() {
  if (document.exitFullscreen) await document.exitFullscreen();
  else if (document.webkitExitFullscreen) document.webkitExitFullscreen(); // Safari
}

async function toggleFullscreen() {
  if (isFullscreen()) await exitFullscreen();
  else await enterFullscreen();
}

document.addEventListener('fullscreenchange', () => {
  const state = isFullscreen();
  fsBtn.setAttribute('aria-pressed', state ? 'true' : 'false');
  fsBtn.textContent = state ? 'Quitter plein √©cran' : '‚õ∂ Plein √©cran';
});

// clic bouton
fsBtn.addEventListener('click', toggleFullscreen);

// raccourci clavier F (Esc sort du plein √©cran automatiquement)
window.addEventListener('keydown', (e) => {
  if (['INPUT','TEXTAREA','SELECT'].includes(document.activeElement?.tagName)) return;
  if (e.key.toLowerCase() === 'f') { e.preventDefault(); toggleFullscreen(); }
});
// ===== Gestes tactiles (swipe) =====
const surface = document.querySelector('.viewer'); // ou '.stage' si tu veux limiter aux images
let touchStartX = 0, touchStartY = 0, touchStartT = 0;

const SWIPE_DIST = 50;   // distance minimale en px
const SWIPE_TIME = 700;  // dur√©e max en ms
const ANGLE_TOL = 20;    // tol√©rance d'angle en degr√©s (pour bien s√©parer H/V)

// Helpers
function deg(absDy, absDx){ return Math.atan2(absDy, absDx) * 180 / Math.PI; }
function isUI(el){ return Boolean(el.closest('input,select,button')); }

// Changer d'exercice
function nextExercise(){
  stop();
  currentExercise = (currentExercise + 1) % MANIFEST.length;
  selectEl.value = currentExercise;
  loadExercise();
}
function prevExercise(){
  stop();
  currentExercise = (currentExercise - 1 + MANIFEST.length) % MANIFEST.length;
  selectEl.value = currentExercise;
  loadExercise();
}

surface.addEventListener('touchstart', (e) => {
  if (isUI(e.target)) return;          // ne pas capter sur les contr√¥les
  if (e.touches.length !== 1) return;  // un seul doigt
  touchStartX = e.touches[0].clientX;
  touchStartY = e.touches[0].clientY;
  touchStartT = Date.now();
}, { passive: true });

surface.addEventListener('touchend', (e) => {
  if (!touchStartT) return;
  const t = Date.now() - touchStartT;
  touchStartT = 0;
  if (t > SWIPE_TIME) return;

  const touch = e.changedTouches && e.changedTouches[0];
  if (!touch) return;

  const dx = touch.clientX - touchStartX;
  const dy = touch.clientY - touchStartY;
  const adx = Math.abs(dx), ady = Math.abs(dy);
  if (adx < SWIPE_DIST && ady < SWIPE_DIST) return;

  // S√©paration horizontal vs vertical par l'angle
  const a = deg(ady, adx); // angle vs horizontal
  if (a <= ANGLE_TOL) {
    // swipe horizontal : exercice
    e.preventDefault();
    if (dx < 0) nextExercise();   // ‚Üê swipe gauche = exercice suivant
    else prevExercise();          // ‚Üí swipe droite = exercice pr√©c√©dent
    return;
  }
  if (a >= 90 - ANGLE_TOL) {
    // swipe vertical : sc√©nario
    e.preventDefault();
    stop();
    if (dy < 0) next();  // ‚Üë suivant
    else prev();         // ‚Üì pr√©c√©dent
  }
}, { passive: false });

// (Optionnel) : retour visuel l√©ger dans la barre de statut
document.addEventListener('fullscreenchange', () => {
  const state = document.fullscreenElement != null;
  statusEl.textContent = state ? 'Plein √©cran activ√©' : 'Plein √©cran d√©sactiv√©';
  setTimeout(() => { statusEl.textContent = `√âtape ${idx+1} / ${layers.length}`; }, 900);
});

  </script>
</body>
</html>
